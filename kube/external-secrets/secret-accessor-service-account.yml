apiVersion: v1
kind: ServiceAccount
metadata:
  name: secret-accessor-ksa
  namespace: vscn
  annotations:
    iam.gke.io/gcp-service-account: vscn-secret-accessor-iam@leafy-beach-375514.iam.gserviceaccount.com


# leafy-beach-375514.svc.id.goog

## Create IAM service account
# gcloud iam service-accounts create vscn-secret-accessor-iam --project=leafy-beach-375514


## Add Role to IAM service account
# gcloud projects add-iam-policy-binding leafy-beach-375514 \
#     --member "serviceAccount:vscn-secret-accessor-iam@leafy-beach-375514.iam.gserviceaccount.com" \
#     --role "roles/secretmanager.secretAccessor"


## Bind IAM service account with workload identity / K8s role
# gcloud iam service-accounts add-iam-policy-binding vscn-secret-accessor-iam@leafy-beach-375514.iam.gserviceaccount.com \
#     --role roles/iam.workloadIdentityUser \
#     --member "serviceAccount:leafy-beach-375514.svc.id.goog[vscn/secret-accessor-ksa]"
#     --project=leafy-beach-375514


## Bind K8s service account with IAM service account
#   kubectl annotate serviceaccount secret-accessor-ksa \
#     --namespace vscn \
#     iam.gke.io/gcp-service-account=vscn-secret-accessor-iam@leafy-beach-375514.iam.gserviceaccount.com